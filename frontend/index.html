<html>
  <body style="background-color: #000">
    <h1 style="color: #fff">Hello from Express!</h1>
    <p style="color: #fff" id="serverMessage"></p>
    <p style="color: #fff" id="greeting">Hello</p>
    <p style="color: #fff" id="hour">time</p>
    <button onclick="displayMessage()">display message</button>
    <button onclick="greets()">display time</button>
    <button onclick="time()">display hour</button>
    <input id="userInput" placeholder="Type a message" />
    <button onclick="sendMessage()">Send</button>
    <p id="serverReply" style="color: #fff"></p>
  </body>
</html>

<script>
i = 0;

async function displayMessage(){
  try {
    const res = await fetch("/api/test");
    const data = await res.json();
    i++;
    document.getElementById("serverMessage").textContent = data.message + i;
  } catch (error) {
    console.log("display failed", error);
  }

}

async function greets(){
  try {
    const res = await fetch("/api/test");
    const data = await res.json();
    document.getElementById("greeting").textContent = data.time;
  } catch (error) {
    console.log("fail to get time", error);
  }

}

async function time(){
  try {
    const res = await fetch("/api/time");
    const data = await res.json();
    document.getElementById("hour").textContent = data.message;
  } catch (error) {
    console.log("failed to fetch hour", error)
  }
}

async function sendMessage(){
  const input = document.getElementById("userInput").value;

  try {
    const res = await fetch("/api/echo", {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify({message: input})
    });

    const data = await res.json();
    document.getElementById("serverReply").textContent = data.reply;
  } catch (error) {
    console.error("Failed to send message:", error)
  }
}
</script>